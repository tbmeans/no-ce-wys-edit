<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Post Writer</title>
  <style>
    body {
      background-color: #333;
    }
    #main-container {
      background-color: #777;
      margin: 1in 1in;
      min-height: 40rem;
    }
    #main-container:focus {
      background-color: #888;
    }
    #write-space {
      white-space: pre;
      padding: 2rem 2rem;
    }
    @keyframes blinky {
      from {
        color: black;
      }
      to {
        color: gray;
      }
    }
    #cursor {
      animation: 1s infinite blinky;
    }
  </style>
</head>
<body>
  <div id="main-container" tabindex="0">
    <p id="write-space"><span id="cursor">|</span></p>
  </div>
<script>
const mcont = document.getElementById("main-container");
const space = document.getElementById("write-space");
const cursor = document.getElementById("cursor");
const getText = () => {
  const nodes = Array.from(space.childNodes);
  return nodes.length === 3 && [ nodes[0], nodes[2] ] ||
      nodes[0].nodeValue && [ nodes[0], null ] || [ null, nodes[1] ];
};
const charEdit = (value) => {
  const [ precurs, postcur ] = getText();
  if (value === -1 && precurs) {
    precurs.nodeValue = precurs.nodeValue.slice(0, -1);
  } else if (value === +1 && postcur) {
    postcur.nodeValue = postcur.nodeValue.slice(1);
  } else if (typeof value === "string" && !precurs) {
    space.insertBefore(document.createTextNode(value), cursor);
  } else if (typeof value === "string") {
    precurs.nodeValue = precurs.nodeValue + value;
  }
  // Instead of a separate function to call to clear empty nodes,
  // just clear any empty nodes after edit logic.
  if (postcur && postcur.nodeValue.length === 0) {
    space.removeChild(postcur);
  }
  if (precurs && precurs.nodeValue.length === 0) {
    space.removeChild(precurs);
  }
};
const moveCurs = (direction) => {};
const keyfuncs = (event) => {
  switch(event.key) {
    case "Backspace":
      charEdit(-1);
      break;
    case "Delete": 
      charEdit(+1);
      break;
    case "Enter":
      charEdit('\n');
      break;
    case "Tab":
    case "Shift":
    case "Control":
    case "CapsLock":
    case "NumLock":
      break;
    default:
      charEdit(event.key);
  }
}
mcont.addEventListener("focus", (event) => {
  mcont.addEventListener("keydown", keyfuncs);
});
mcont.addEventListener("blur", (event) => {
  mcont.removeEventListener("keydown", keyfuncs);
});
</script>
</body>
</html>
